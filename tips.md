# 「NDLデータ利活用ワークショップ～ウェブ・アーカイブの自治体サイトを可視化しよう～」ティップス

- 2016年7月30日開催の「NDLデータ利活用ワークショップ」でのティップスです。
- http://lab.ndl.go.jp/cms/?q=visualize2016



## 簡易APIから定量データをえるには

- ファセットを利用します
	- 簡易API利用時に「ファセット」フィールドで選んだものごとに、検索結果からカウントしてくれる。

- ピボットを利用します
	- 簡易API利用時に「ピボット」フィールドへ prefName,collectedYear などと入力する。
	- 上位のファセット（例：prefName）の結果から、さらに別フィールドのファセット（例：collectedYear）が作り出せる

- 自治体種別をうまく利用します
	- 市区町村で比較、政令指定都市で比較、23区で比較、23区とその他市町村で比較、など…

- 収集年をうまく利用します
	- 同一条件の検索結果を2010年、2013年、2015年で比較する。

- 検索結果の「キーワード」で出てきた単語を数える
	- ,（カンマ）を改行コード（\n）へ変換し、一行あたり一単語の状態にする。
	- Excelで開き、フィルタを実行し、各単語の数を数える。
	- OpenRefineで開き、テキストファセット機能を利用する。

## 複数のデータを組み合わせる（マージする）には

- 標準地方コード（mcode）を用います。
- ファセットtsvには標準地方コードが含まれないので、その場合は「自治体名でつなげる」か「基礎データにあるファイルとマージして標準地方コードを付加」してください。
- Cartoはブラウザ上でマージできます。
- Excelのvlookupを使うとマージできます。
- もちろんコーディングでマージすることもできます。

## 6桁の標準地方コードがある…?

- 今回NDL APIで用いている標準地方コードは五桁です。他のデータセットに六桁のコードがある場合はチェックディジット(六桁目)が含まれています。自分でコーディングする場合はともかくウェブアプリ上でマージしようとするとうまくいかない場合があります。その場合はExcelで、六桁目を削除してください。

```
//A1に六桁の数値がある場合
=REPLACE(A1, 6,1,"")
```

## 国土数値情報などにあるShapefileを使いたいのだけど、処理に時間がかかる！

- 行政区分（地形）についてはダウンロードしてGeoJSON／UTF-8に整形したものがあります（2015年のデータ）。

	- [行政区域/都道府県別](行政区域/都道府県別) 

- ツール／geojson-conversion.sh を使うと、同一階層にあるshapefileファイルを一気にGeoJSON化することができます。Shapefileを同一階層へ集め、geojson-conversion.shも同じ階層に置き、ターミナル（Mac）／コンソール（Windows）から

	- [ツール/geojson-conversion.sh](ツール/geojson-conversion.sh) 

```
sh geojson-conversion.sh
```

を実行します。実行するとGeoJSONに変換され、文字コードがUTF-8になっています。

